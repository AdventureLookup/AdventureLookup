{% if app.user %}
    <div id="create-review-container" class="mt-0 mb-3 d-none" data-has-reviewed="{{ adventure.reviewBy(app.user) ? '1' : '0' }}">
        <div class="row" id="review-thumbs-row">
            <div class="col-auto d-flex align-items-center" id="review-thumbs-up">
                <i class="fa fa-fw fa-thumbs-up fa-flip-horizontal"></i>
            </div>
            <div class="col" id="review-thumbs-message"></div>
            <div class="col-auto d-flex align-items-center" id="review-thumbs-down">
                <i class="fa fa-fw fa-thumbs-down"></i>
            </div>
        </div>
        {{ form_start(review_form, {'attr': {'id': 'review_form'}}) }}
        {{ form_widget(review_form.rating) }}
        {{ form_widget(review_form.comment) }}
        {{ form_end(review_form) }}
    </div>
{% endif %}

<div id="review-container" class="mt-0" data-vote-url="{{ path('review_vote', {'id': '_ID_'}) }}" data-vote-csrf-token="{{ csrf_token('review_voting') }}">
    <div class="row">
        <div class="col">
            <h3 class="title">Reviews</h3>
        </div>
        <div class="col-auto">
            <div class="title">
                <i class="fa fa-fw fa-thumbs-o-up"></i> {{ adventure.numberOfThumbsUp }}
                <i class="fa fa-fw fa-thumbs-o-down"></i> {{ adventure.numberOfThumbsDown }}
            </div>
        </div>
    </div>
    {% if not app.user %}
        <div class="alert alert-info">Please sign in to rate or leave a review.</div>
    {% elseif adventure.reviewBy(app.user) %}
        <div class="alert alert-success">You've already rated/reviewed this adventure.</div>
    {% endif %}
    {% for review in adventure.sortedReviewsWithComments %}
        <div class="review" data-review-id="{{ review.id }}">
            <p class="d-flex w-100 justify-content-between">
                <span>
                    <strong>{{ review.createdBy }}</strong> has played this adventure and would {{ review.thumbsDown ? 'not' : '' }} recommend it.
                </span>
                <span>
                    <i class="fa fa-fw fa-thumbs-up"></i> <span class="review-upvotes">{{ review.countUpvotes }}</span>
                    <i class="fa fa-fw fa-thumbs-down"></i> <span class="review-downvotes">{{ review.countDownvotes }}</span>
                </span>
            </p>
            <blockquote>
                <div class="row">
                    <div class="col col-auto d-none d-sm-flex">
                        <i class="fa fa-quote-left fa-3x review-icon"></i>
                    </div>
                    <div class="col">
                        {{ review.comment|nl2br }}
                    </div>
                </div>
            </blockquote>
            <div class="d-flex w-100 justify-content-between">
                <div>
                    {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
                        <span>Has this review been helpful?</span>
                        <div class="review-voting d-inline">
                            <button class="btn btn-sm btn-{% if review.hasUpvoteBy(app.user) %}success{% else %}outline-secondary{% endif %} review-vote-up">yes</button>
                            <button class="btn btn-sm btn-{% if review.hasDownvoteBy(app.user) %}success{% else %}outline-secondary{% endif %} review-vote-down">no</button>
                        </div>
                    {% endif %}
                </div>
                {% if is_granted('delete', review) %}
                    <span>
                        {{ form_start(review_delete_form, {'action': path('review_delete', {id: review.id})}) }}
                        {{ form_widget(review_delete_form) }}
                        <button type="submit" class="text-danger btn btn-link"
                                role="button"
                                onclick="return confirm('Do you really want to delete this review?')">
                            <i class="fa fa-trash"></i> Delete Review
                        </button>
                        {{ form_end(review_delete_form) }}
                    </span>
                {% endif %}
            </div>
        </div>
    {% else %}
        <div class="review">
            This adventure has not been reviewed yet.
        </div>
    {% endfor %}
</div>
